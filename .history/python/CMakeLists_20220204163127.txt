

MESSAGE("------setting up Python bindings-------")
include(FetchContent)
FetchContent_Declare(
    pybind11
    GIT_REPOSITORY https://github.com/pybind/pybind11
    GIT_TAG        v2.8.1
)

FetchContent_GetProperties(pybind11)
if(NOT pybind11_POPULATED)
    FetchContent_Populate(pybind11)
    add_subdirectory(${pybind11_SOURCE_DIR} ${pybind11_BINARY_DIR})
    message(${pybind11_BINARY_DIR})
endif()

include_directories(
    inc
    ${GPUNUFFT_INC_DIR}
    ${PYTHON_INCLUDE_DIRS}
    ${pybind11_INCLUDE_DIRS}
    ${FASTSUM_INC_DIR}
    )

message("pybind : ${pybind11_INCLUDE_DIR}")
message("python inc : ${PYTHON_INCLUDE_DIRS}")
message("python lib : ${PYTHON_LIBRARIES}")
find_package(OpenMP)
if (OPENMP_FOUND)
    set (CMAKE_C_FLAGS "${CMAKE_C_FLAGS} ${OpenMP_C_FLAGS}")
    set (CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${OpenMP_CXX_FLAGS}")
    set (CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} ${OpenMP_EXE_LINKER_FLAGS}")
endif()
set(PYTHON_BINDINGS src/python_factory.cpp
                    src/python_bindings.cpp
                    src/fastsum_binder.cpp)
cuda_include_directories(${GPUNUFFT_INC_DIR})
cuda_add_library(gpuNUFFT ${GPU_CU_SOURCES}
                          ${GPU_GPUNUFFT_SOURCES}
                          ${GPUNUFFT_SOURCES}
                          ${GPUNUFFT_INCLUDE}
                          ${PYTHON_BINDINGS}
                          ${FASTSUM_SOURCES}
                          SHARED)

set_target_properties(gpuNUFFT PROPERTIES PREFIX "")
target_link_libraries(gpuNUFFT ${CUDA_LIBRARIES} ${CUDA_curand_LIBRARY})
target_link_libraries(gpuNUFFT nfft3f_threads fftw3f_threads)


CUDA_ADD_CUFFT_TO_TARGET(gpuNUFFT)
CUDA_ADD_CUBLAS_TO_TARGET(gpuNUFFT)
